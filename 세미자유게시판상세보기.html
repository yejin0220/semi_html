<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ììœ ê²Œì‹œíŒë“±ë¡</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        h1 {
            color: rgb(255, 209, 51);
            font-family: Arial, sans-serif;
            border-bottom: 1px solid black;
            line-height: 50px;
        }

        .free_header {
            position: relative;
        }

        .free_img1 {
            position: absolute;
            bottom: 65px;
            right: 230px;
            left: 0;
        }

        .free_img2 {
            position: absolute;
            right: 0px;
            left: 230px;
            bottom: 65px;
        }

        a {
            text-decoration: none;
            color: black;
        }

        .free_main {
            max-width: 1460px;
            margin: 0 auto;
            padding: 20px;
        }

        .free_content_header>#free_content_header1 {
            width: 900px;
            height: 48px;
            padding: 0 10px;
            border: 2px solid #ccc;
            border-radius: 5px;
            color: rgb(94, 94, 94);
            font-size: 20px;
        }

        .free_content_header>#free_content_header2 {
            width: 900px;
            height: 30px;
            padding: 0 10px;
            border: 2px solid #ccc;
            border-radius: 5px;
            color: rgb(94, 94, 94);
        }

        .free_content_main {
            width: 900px;
            height: auto;
            padding: 0 10px;
            border: 2px solid #ccc;
            border-radius: 5px;
            margin-left: 268px;
            color: rgb(94, 94, 94);
            font-size: 14px;
        }

        input:focus,
        textarea:focus,
        .free_content_main:focus {
            outline: none;
        }

        .free_back {
            background-color: rgb(230, 242, 255);
            color: rgb(0, 123, 255);
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .free_retouch {
            background-color: rgb(230, 242, 255);
            color: rgb(0, 123, 255);
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .free_delete {
            background-color: rgb(255, 209, 51);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .free_content_reply1 {
            width: 900px;
            height: auto;
            padding: 0 10px;
            border: 2px solid #ccc;
            border-radius: 5px;
            margin-left: 268px;
            color: rgb(94, 94, 94);
            font-size: 14px;
        }

        #form-commentInfo {
            width: 100%;
        }

        #comment-count {
            margin-bottom: 10px;
        }

        #comment-input {
            width: 820px;
            height: auto;
            min-height: 80px;
            border: 2px solid #ccc;
        }

        #submit {
            background-color: rgb(230, 242, 255);
            width: 5.5em;
            height: 3.3em;
            font-size: 15px;
            font-weight: bold;
            color: rgb(0, 123, 255);
            cursor: pointer;
            border: none;
        }

        #voteUp,
        #voteDown {
            width: 3.5em;
            height: 1.9em;
            background-color: aqua;
            border: none;
        }

        #comments {
            margin-top: 10px;
        }

        .eachComment {
            width: 810px;
            height: auto;
            padding: 0.5em;
            border: 2px solid #ccc;
            margin-right: 88px;
        }

        .eachComment .name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 0.3em;
            display: flex;
            justify-content: space-between;
        }

        .eachComment .inputValue {
            font-size: 16px;
            display: flex;
        }

        .eachComment .time {
            font-size: 0.7em;
            color: #ccc;
            margin-right: 710px;
            
        }

        .eachComment .voteDiv {
            display: flex;
            justify-content: flex-end;
        }

        .eachComment .deleteComment {
            background-color: rgb(255, 209, 51);
            color: white;
            border: none;
            cursor: pointer;
        }

        .eachComment .modifyBtn {
            background-color: rgb(230, 242, 255);
            color: rgb(0, 123, 255);
            border: none;
            cursor: pointer;
            margin-left: 660px;
        }

        .modal {

            /* ëª¨ë‹¬ css ì •ë³´ëŠ” https://codepen.io/sdthornton/pen/wBZdXq ì—¬ê¸°ì°¸ê³ í•˜ë©´ ë¨ */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23);
            /* ëª¨ë‹¬ì°½ í¬ê¸° 100% ë§Œë“¤ê¸° ìœ„í•œ ì„¤ì • => ìŠ¤í¬ë¦°ì— ê½‰ì±„ìš´ê±°. */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* ëª¨ë‹¬ì°½ ëœ¨ë©´ì„œ ë’¤ì— ì˜¤ë²„ë ˆì´ ë°°ê²½ì¤€ê±°. ëª¨ë‹¬ì°½í•˜ê³  ê°™ì´ ëŒì–´ì˜´. */
        .modal__overlay {
            background-color: rgba(0, 0, 0, 0.6);
            width: 100%;
            height: 100%;
            position: absolute;

        }

        .modal__content {
            background-color: white;
            padding: 50px 100px;
            text-align: center;
            position: relative;
            width: 15%;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.19), 0 6px 6px rgba(0, 0, 0, 0.23);
            border-radius: 15px;

        }

        .modal__content #modifyVal {
            margin-bottom: 1em;
            width: 100%;
            height: 3.3em;
        }



        #inBtn {
            display: flex;
            justify-content: center;
        }

        #inBtn #ok {
            all: unset;
            background-color: rgb(230, 242, 255);
            color: rgb(0, 123, 255);
            padding: 5px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;

        }

        #inBtn #cancle {
            all: unset;
            background-color: rgb(230, 242, 255);
            color: rgb(0, 123, 255);
            padding: 5px 20px;
            border-radius: 5px;
            cursor: pointer;

        }

        #modifyVal{
            border-radius: 5px;
            border: 2px solid #ccc;
        }

        .hidden {
            display: none;
        }
    </style>

</head>

<body>
    <div class="free_header" align="center">
        <div class="free_img1">
            <img src="https://semiproject.s3.ap-northeast-2.amazonaws.com/%ED%95%9C%EB%8F%99%ED%9C%98/free-icon-dog-2396837.png"
                alt="" width="44" height="45">
        </div>
        <div class="free_img2">
            <img src="https://semiproject.s3.ap-northeast-2.amazonaws.com/%ED%95%9C%EB%8F%99%ED%9C%98/free-icon-cat-2195875.png"
                alt="" width="44" height="45">
        </div>
        <h1>ë©ëƒ¥ìˆ˜ë‹¤ë°©</h1>
        <p>ìš°ë¦¬ ì•„ì´ ìë‘ë„í•˜ê³  ì •ë³´ë„ ë‚˜ëˆ„ê³ <br>
            ê¶ê¸ˆí•œ ê±´ ì§ˆë¬¸ë„ í•´ìš”!
        </p>
    </div>
    <div class="free_main">

        <div class="free_content_header" align="center" spellcheck="false">
            <input type="text" name="free_content_header1" id="free_content_header1" value="[ì´ê±°ë³´ì‹œê°œ] ìš°ë¦¬ì§‘ ê°±ì–¼ì¥ ë„˜ë‚˜ ì´ì©ë‹ˆë‹¤..">
            <input type="text" name="free_content_header2" id="free_content_header2"
                value="ê°•ì•„ì§€ì§± || 2023.03.16 || ì¡°íšŒìˆ˜ 1">
        </div>

        <div class="free_content_main" contentEditable='true' spellcheck="false">
            ìš°ë¦¬ì§‘ ê°±ì–¼ì¥ ê¸°ì ˆí–ˆìŠµë‹ˆë‹¤ ë³´ê³ ê°€ì‹œê°œ...<br><br>
            <img
                src="https://mblogthumb-phinf.pstatic.net/MjAyMDExMDdfNTAg/MDAxNjA0NzU0MDQ4MjEw.snzHJGCvS17m8NnMHBTYtliW9n73JScNfUmrg_wrZfkg.LiQDnJwVuRmkmof47SHAsQ7q6H5sQ4y4w41l1fPY-pUg.JPEG.parkamsterdam/IMG_5575.JPG?type=w800">
        </div>

        <div class="free_buttons1" align="center">
            <button type="button" class="free_back">ëª©ë¡ìœ¼ë¡œ</button>
            <button type="submit" class="free_retouch">ìˆ˜ì •í•˜ê¸°</button>
            <button type="button" class="free_delete">ì‚­ì œí•˜ê¸°</button>
        </div>
        <br><br><br><br><br>

        <div id="form-commentInfo" align="center" >
            <div id="comment-count" style="margin-right: 870px;">ëŒ“ê¸€ <span id="count">0</span></div>
            <input id="comment-input" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”." spellcheck="false">
            <button id="submit">ë“±ë¡</button>
        </div>

        <div id=comments align="center">

        </div>

    </div>

    <script>

        const inputBar = document.querySelector("#comment-input");
        const rootDiv = document.querySelector("#comments");
        const btn = document.querySelector("#submit");
        const mainCommentCount = document.querySelector('#count'); //ë§¨ìœ„ ëŒ“ê¸€ ìˆ«ì ì„¸ëŠ”ê±°.

        //ê¸€ë¡œë²Œë¡œ ëºìŒ. ê°’ì„ ì €ì¥í•˜ê¸° ìœ„í•´ì„œ.
        let idOrVoteCountList = [];


        //íƒ€ì„ìŠ¤í…œí”„ ë§Œë“¤ê¸°
        function generateTime() {
            const date = new Date();
            const year = date.getFullYear();
            const month = date.getMonth();
            const wDate = date.getDate();
            const hour = date.getHours();
            const min = date.getMinutes();
            const sec = date.getSeconds();

            const time = year + '-' + month + '-' + wDate + ' ' + hour + ':' + min + ':' + sec;
            return time;

        }

        //ìœ ì €ì´ë¦„ ë°œìƒê¸°
        //ìœ ì €ì´ë¦„ì€ 8ê¸€ìë¡œ ì œí•œ.
        function generateUserName() {
            let alphabet = 'abcdefghijklmnopqrstuvwxyz';
            var makeUsername = '';
            for (let i = 0; i < 4; i++) {
                let index = Math.floor(Math.random(10) * alphabet.length);
                makeUsername += alphabet[index];
            }
            for (let j = 0; j < 4; j++) {
                makeUsername += "*";
            }
            return makeUsername;
        }

        function numberCount(event) {
            console.log(event.target.parentNode.id);
            for (let i = 0; i < idOrVoteCountList.length; i++) {
                if (event.target.className === "voteUp") {

                    //event.target.parentNode.id ê°’ì´ stringì´ê¸° ë•Œë¬¸ì— ì´ ê°’ì„ Numberì²˜ë¦¬í•˜ë˜ì§€, idOrVoteCountList[i]["commentId"]ì´ ê°’ì„ stringì²˜ë¦¬í•´ì•¼ ë„˜ì–´ê°.
                    if (idOrVoteCountList[i]["commentId"].toString() === event.target.parentNode.id) {
                        idOrVoteCountList[i]["voteUpCount"]++;
                        event.target.innerHTML = "ğŸ‘" + idOrVoteCountList[i]["voteUpCount"];
                    }

                } else if (event.target.className === "voteDown") {
                    if (idOrVoteCountList[i]["commentId"].toString() === event.target.parentNode.id) {
                        idOrVoteCountList[i]["voteDownCount"]++;
                        event.target.innerHTML = "ğŸ‘" + idOrVoteCountList[i]["voteDownCount"];
                    }
                }

            }
        }

        //ê¸°ì¡´ì— ë‚¨ì•„ìˆë˜ idì´ˆê¸°í™” ë° ìƒˆë¡œì¶”ê°€ëœë¶€ë¶„ë§Œ ì½”ë©˜íŠ¸ê°’ ì´ì–´ì„œ ë“¤ì–´ì˜´.
        function initIdCount() {
            for (let i = 0; i < idOrVoteCountList.length; i++) {
                if (idOrVoteCountList[i]["commentId"] - i > 1) {
                    idOrVoteCountList[i]["commentId"] = idOrVoteCountList[i]["commentId"] - (idOrVoteCountList.length - (i + 1));
                }
            }
        }


        function deleteComments() {
            const btn = event.target;
            const list = btn.parentNode.parentNode;//commentList
            //ì‚­ì œë²„íŠ¼ë„ ë§ˆì°¬ê°€ì§€ì„. ì—¬ëŸ¬ê°œë‹ˆê¹ ì¸ì‹ì„ ëª»í•¨. ìƒìœ„ë…¸ë“œì— id ë¶€ì—¬í•¨.    
            //ì‚­ì œë²„íŠ¼ í´ë¦­í•œ ë°°ì—´ì˜ ì¸ë±ìŠ¤ë¥¼ ë‚ ë¦¬ë©´ ë¨. ë­ ì—¬ê¸°ê¹Œì§€ í•´ë„ ìƒê´€ì—†ëŠ”ë°...
            for (let i = 0; i < idOrVoteCountList.length; i++) {
                if (idOrVoteCountList[i]["commentId"].toString() === btn.parentNode.id) {
                    idOrVoteCountList.splice(btn.parentNode.id - 1, 1);
                }

            }
            //ê·¸ë‹¤ìŒì— ì „ì²´ ì§€ìš°ê¸°.
            rootDiv.removeChild(list);

            //ë©”ì¸ëŒ“ê¸€ ì¹´ìš´íŠ¸ ì¤„ì´ê¸°. 
            if (mainCommentCount.innerHTML <= '0') {
                mainCommentCount.innerHTML = 0;
            } else {
                mainCommentCount.innerHTML--;
            }
        }

        //ìˆ˜ì •ì°½ ëª¨ë‹¬ë¡œ ë§Œë“¤ê¸°
        function modifyComments(event) {

            const mBtn = event.target;

            //ëª¨ë‹¬ì°½ ë§Œë“¤ê¸°
            const modal = document.createElement('div')
            const modalOverlay = document.createElement('div');
            const modalContent = document.createElement('div');
            const cancleBtn = document.createElement('button');
            const okBtn = document.createElement('button');
            const input = document.createElement('input');
            const span = document.createElement('span');
            modal.className = "modal hidden";
            modalOverlay.className = "modal__overlay";
            modalContent.className = "modal__content";
            okBtn.id = "ok";
            okBtn.innerHTML = "ìˆ˜ì •";
            cancleBtn.id = "cancle";
            cancleBtn.innerHTML = "ì·¨ì†Œ";
            input.id = "modifyVal";
            input.placeholder = "ë³€ê²½í•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”";
            span.id = "inBtn";

            span.appendChild(okBtn);
            span.appendChild(cancleBtn);
            modalContent.appendChild(input);
            modalContent.appendChild(span);
            modal.appendChild(modalOverlay);
            modal.appendChild(modalContent);
            rootDiv.appendChild(modal);

            modal.classList.remove("hidden");

            cancleBtn.addEventListener("click", function () {
                modal.classList.add("hidden");
            });


            okBtn.addEventListener("click", function (event) {
                console.dir(mBtn.parentNode.parentNode.children[1]);

                for (var i = 0; i < idOrVoteCountList.length; i++) {
                    if (idOrVoteCountList[i]["commentId"].toString() === mBtn.parentNode.id) {
                        idOrVoteCountList[i]["commentValue"] = input.value;
                        //ìˆ˜ì •ë²„íŠ¼ëˆ„ë¥´ë©´ ë³€ê²½.              
                        mBtn.parentNode.parentNode.children[1].innerHTML = input.value;
                        modal.classList.add("hidden");
                    }
                }
            });

        }


        //ëŒ“ê¸€ë³´ì—¬ì£¼ê¸°
        function showComment(comment) {
            const userName = document.createElement('div');
            const inputValue = document.createElement('span');
            const showTime = document.createElement('div');
            const voteDiv = document.createElement('div');
            const countSpan = document.createElement('span')
            const voteUp = document.createElement('button');
            const voteDown = document.createElement('button');
            const commentList = document.createElement('div');  //ì´ë†ˆì´ ìŠ¤ì½”í”„ ë°–ìœ¼ë¡œ ë‚˜ê°€ëŠ” ìˆœê°„ í•˜ë‚˜ì§€ìš°ë©´ ë‹¤ ì§€ì›Œì§€ê³  ì…ë ¥í•˜ë©´ ë¦¬ìŠ¤íŠ¸ ë‹¤ë¶ˆëŸ¬ì˜´.
            const modifyBtn = document.createElement('button');
            const spacer = document.createElement('div');

            const newId = idOrVoteCountList.length + 1; //ëŒ“ê¸€í•˜ë‚˜ì— ë‹¬ë¦° ID

            
            //ìŠ¤í˜ì´ì„œë§Œë“¤ê¸°
            spacer.className = "spacer";
            //ì‚­ì œë²„íŠ¼ ë§Œë“¤ê¸°
            const delBtn = document.createElement('button');
            delBtn.className = "deleteComment";
            delBtn.innerHTML = "ì‚­ì œ";
            commentList.className = "eachComment";
            userName.className = "name";
            userName.id = newId; //ì‚­ì œ,ìˆ˜ì •ë²„íŠ¼ì˜ ìƒìœ„ë…¸ë“œ. 
            inputValue.className = "inputValue";
            showTime.className = "time";
            voteDiv.className = "voteDiv";
            voteDiv.id = newId;
            //ì¶”ê°€
            inputValue.id = newId;

            //ìˆ˜ì •ë²„íŠ¼ ë§Œë“¤ê¸°
            modifyBtn.className = 'modifyBtn';
            modifyBtn.innerHTML = "ìˆ˜ì •";
            
            //ìœ ì €ë„¤ì„ê°€ì ¸ì˜¤ê¸° 
            userName.innerHTML = generateUserName();
            userName.appendChild(spacer);
            userName.appendChild(modifyBtn);
            userName.appendChild(delBtn);
            //ì…ë ¥ê°’ ë„˜ê¸°ê¸°
            inputValue.innerText = comment;
            //íƒ€ì„ìŠ¤í…œí”„ì°ê¸°
            showTime.innerHTML = generateTime();
            countSpan.innerHTML = 0;
            //íˆ¬í‘œì°½ ë§Œë“¤ê¸°, cssë¨¼ì € ì…í˜€ì•¼í•¨. 
            voteUp.className = "voteUp";
            voteDown.className = "voteDown";
            voteUp.innerHTML = "ğŸ‘" + 0;
            voteDown.innerHTML = "ğŸ‘" + 0;
            voteDiv.appendChild(voteUp);
            voteDiv.appendChild(voteDown);

            //ëŒ“ê¸€ë¿Œë ¤ì£¼ê¸°       
            commentList.appendChild(userName);
            commentList.appendChild(inputValue);
            commentList.appendChild(showTime);
            commentList.appendChild(voteDiv);
            rootDiv.prepend(commentList);

            //ì•„ì´ë””ì— ë”°ë¥¸ íˆ¬í‘œìˆ˜ì¹´ìš´íŠ¸. ë°°ì—´ì— ì ‘ê·¼í•´ì„œ ìˆ˜ì •í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í•´ì•¼í•¨.
            let IdAccordingToVoteCount = {
                "commentId": newId,
                "voteUpCount": 0,
                "voteDownCount": 0,
                "commentValue": comment   //ì¶”ê°€
            }

            idOrVoteCountList.push(IdAccordingToVoteCount);
            console.log(idOrVoteCountList);

            initIdCount();


            voteUp.addEventListener("click", numberCount);
            voteDown.addEventListener("click", numberCount);
            delBtn.addEventListener("click", deleteComments);
            modifyBtn.addEventListener("click", modifyComments);

        }



        //ë²„íŠ¼ë§Œë“¤ê¸°+ì…ë ¥ê°’ ì „ë‹¬
        function pressBtn() {

            const currentVal = inputBar.value;

            if (!currentVal.length) {
                alert("ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!!");
            } else {
                showComment(currentVal);
                mainCommentCount.innerHTML++;
                inputBar.value = '';
            }
        }

        btn.onclick = pressBtn;

    </script>
</body>

</html>